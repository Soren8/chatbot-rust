<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, maximum-scale=1.0, user-scalable=no">
    <title>AI Chat</title>
    <meta name="csrf-token" content="{{ csrf_token }}">
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" {% if sri.bootstrap_css %}integrity="{{ sri.bootstrap_css }}" crossorigin="anonymous"{% else %}crossorigin="anonymous"{% endif %}>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" {% if sri.bootstrap_icons_css %}integrity="{{ sri.bootstrap_icons_css }}" crossorigin="anonymous"{% else %}crossorigin="anonymous"{% endif %}>
    <link rel="stylesheet" href="/static/style.css">
    
</head>
<body id="app-root" class="d-flex flex-column vh-100 bg-dark text-light"
      data-logged-in="{{ 'true' if logged_in else 'false' }}"
      data-user-tier="{{ user_tier }}"
      data-default-system-prompt="{{ default_system_prompt | e }}"
      data-csrf-token="{{ csrf_token }}">
    <!-- Bootstrap Navbar for header controls -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <button id="settings-toggle" class="btn btn-outline-light me-2" type="button" data-bs-toggle="collapse" data-bs-target="#settingsCollapse" aria-controls="settingsCollapse" aria-expanded="false" aria-label="Toggle settings">
                <i class="bi bi-gear-fill" aria-hidden="true"></i>
            </button>
            <span class="navbar-brand navbar-brand-center">AI Chat</span>
            <div class="navbar-nav ms-auto d-flex flex-row align-items-center flex-nowrap gap-3">
                {% if logged_in %}
                <a class="nav-link" href="/logout">Sign Out</a>
                {% else %}
                <a class="nav-link" href="/login">Login</a>
                {% endif %}
            </div>
        </div>
    </nav>
    
    <!-- Premium alert banner -->
    <div id="premium-alert" class="alert alert-warning alert-dismissible fade show m-3" role="alert" style="display: none;">
        ðŸ”’ This model requires a <a href="/upgrade" class="alert-link">Premium Account</a>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <!-- Main layout: settings panel (collapsible) + chat area -->
    <div class="container-fluid flex-grow-1 d-flex flex-column overflow-hidden">
        <div class="row g-0 flex-grow-1 overflow-hidden">
            <!-- Settings column: collapse inside column so it can push content on small screens -->
            <div id="settings-col" class="col-12 col-md-4">
                <div id="settingsCollapse" class="collapse p-3">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0">Settings</h5>
                        <span class="navbar-text ms-auto d-none d-md-inline">Account:
                            <span class="badge bg-{% if user_tier == 'premium' %}success{% else %}secondary{% endif %}">{{ 'Premium' if user_tier == 'premium' else 'Free' }}</span>
                        </span>
                        <span class="navbar-text ms-2 d-inline d-md-none">Account:
                            <span class="badge bg-{% if user_tier == 'premium' %}success{% else %}secondary{% endif %}">{{ 'Premium' if user_tier == 'premium' else 'Free' }}</span>
                        </span>
                    </div>

                    {% if logged_in %}
                    <div class="mb-3">
                        <div class="row g-2 align-items-center mb-2">
                            <label class="col-12 col-md-3 col-form-label mb-0 text-start">Model</label>
                            <div class="col-12 col-md-9">
                                <select id="modelSelect" class="form-select">
                                    {% for llm in available_llms %}
                                    <option value="{{ llm.provider_name }}" data-tier="{{ llm.tier }}">{{ llm.provider_name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <div class="row g-2 align-items-center mb-2">
                            <label class="col-12 col-md-3 col-form-label mb-0 text-start">Set</label>
                            <div class="col-12 col-md-9">
                                <select id="set-selector" class="form-select">
                                    <option value="default">Default Set</option>
                                </select>
                            </div>
                        </div>
                        <div class="d-flex gap-2 pt-3 mb-1">
                            <button id="new-set" class="btn btn-outline-primary">New</button>
                            <button id="delete-set" class="btn btn-outline-danger">Delete</button>
                            <button id="reset-chat" class="btn btn-outline-warning ms-auto">Reset Chat</button>
                        </div>
                    </div>
                    {% endif %}

                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="check-save-thoughts">
                            <label class="form-check-label" for="check-save-thoughts">Save Thinking</label>
                        </div>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="check-send-thoughts">
                            <label class="form-check-label" for="check-send-thoughts">Send AI Thoughts every query</label>
                        </div>
                    </div>

                    <div class="settings-cards d-flex flex-column gap-3">
                        <div class="card mb-0">
                        <div class="card-header">
                            <h6 class="mb-0">System Prompt</h6>
                        </div>
                        <div class="card-body">
                            <textarea id="user-system-prompt" class="form-control" placeholder="User system prompt here..." rows="7"></textarea>
                            <button id="save-system-prompt" class="btn btn-outline-primary mt-2 w-100">Save</button>
                        </div>
                        </div>

                        <div class="card mb-0">
                        <div class="card-header">
                            <h6 class="mb-0">Memory</h6>
                        </div>
                        <div class="card-body">
                            <textarea id="user-memory" class="form-control" placeholder="User memory here..." rows="7"></textarea>
                            <button id="save-memory" class="btn btn-outline-primary mt-2 w-100">Save</button>
                        </div>
                        </div>
                    </div>
                </div>
            </div>

    <!-- Chat Container -->
            <div id="chat-area" class="col-12 col-md-8 d-flex flex-column p-3">
                <div id="chat-box" class="card flex-grow-1 mb-3 position-relative">
                    <div id="chat-content" class="card-body overflow-auto"></div>
                    <button id="scroll-to-bottom" class="btn btn-primary shadow" style="display: none;">
                        <i class="bi bi-arrow-down"></i>
                    </button>
                </div>
                <div class="input-group">
                    <input type="text" id="user-input" class="form-control" placeholder="Type your message here...">
                    <button class="btn btn-outline-primary" type="button" id="send-button">Send</button>
                </div>
            </div>
        </div>
    </div>

    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" {% if sri.jquery %}integrity="{{ sri.jquery }}" crossorigin="anonymous"{% else %}crossorigin="anonymous"{% endif %}></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" {% if sri.bootstrap_js %}integrity="{{ sri.bootstrap_js }}" crossorigin="anonymous"{% else %}crossorigin="anonymous"{% endif %}></script>

    <!-- Machine-readable app data for the client; contains no secrets -->
    <script id="app-data" type="application/json">
    {
        "userTier": "{{ user_tier }}",
        "availableModels": {{ available_llms | default([]) | tojson }},
        "loggedIn": {{ logged_in | tojson }},
        "defaultSystemPrompt": {{ default_system_prompt | tojson }},
        "saveThoughts": {{ save_thoughts | tojson }},
        "sendThoughts": {{ send_thoughts | tojson }}
    }
    </script>
    <script src="/static/chat.js"></script>

    </body>
    </html>